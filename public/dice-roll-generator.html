<!DOCTYPE html>
<html>
  <head>
    <title>Dice Roll Sound Generator</title>
  </head>
  <body>
    <h1>Dice Roll Sound Generator</h1>
    <p>
      Click the button below to generate and download a dice rolling sound
      effect
    </p>
    <button onclick="generateDiceSound()">Generate Sound</button>

    <script>
      function generateDiceSound() {
        const audioContext = new (window.AudioContext ||
          window.webkitAudioContext)();
        const sampleRate = audioContext.sampleRate;
        const duration = 2; // 2 seconds
        const arrayBuffer = audioContext.createBuffer(
          1,
          sampleRate * duration,
          sampleRate
        );
        const channelData = arrayBuffer.getChannelData(0);

        // Generate dice rolling sound (multiple short clicks with decreasing frequency)
        for (let i = 0; i < channelData.length; i++) {
          const t = i / sampleRate;

          // Create a series of clicks that slow down over time
          const clickFrequency = 40 * Math.exp(-t * 2); // Decreasing frequency
          const clickPhase = Math.floor(t * clickFrequency);
          const prevClickPhase =
            i > 0 ? Math.floor(((i - 1) / sampleRate) * clickFrequency) : 0;

          if (clickPhase > prevClickPhase) {
            // Create a click sound (short burst of noise)
            channelData[i] = (Math.random() * 2 - 1) * Math.exp(-t * 3) * 0.5;
          } else {
            // Decay
            channelData[i] = channelData[i - 1] * 0.95;
          }
        }

        // Convert to WAV
        const wav = audioBufferToWav(arrayBuffer);
        const blob = new Blob([wav], { type: "audio/wav" });
        const url = URL.createObjectURL(blob);

        // Download
        const a = document.createElement("a");
        a.href = url;
        a.download = "dice-roll.wav";
        a.click();

        alert("Sound generated! Please convert to MP3 if needed.");
      }

      function audioBufferToWav(buffer) {
        const numChannels = buffer.numberOfChannels;
        const sampleRate = buffer.sampleRate;
        const format = 1; // PCM
        const bitDepth = 16;

        const bytesPerSample = bitDepth / 8;
        const blockAlign = numChannels * bytesPerSample;

        const data = buffer.getChannelData(0);
        const dataLength = data.length * bytesPerSample;
        const headerLength = 44;
        const totalLength = headerLength + dataLength;

        const arrayBuffer = new ArrayBuffer(totalLength);
        const view = new DataView(arrayBuffer);

        // Write WAV header
        writeString(view, 0, "RIFF");
        view.setUint32(4, totalLength - 8, true);
        writeString(view, 8, "WAVE");
        writeString(view, 12, "fmt ");
        view.setUint32(16, 16, true);
        view.setUint16(20, format, true);
        view.setUint16(22, numChannels, true);
        view.setUint32(24, sampleRate, true);
        view.setUint32(28, sampleRate * blockAlign, true);
        view.setUint16(32, blockAlign, true);
        view.setUint16(34, bitDepth, true);
        writeString(view, 36, "data");
        view.setUint32(40, dataLength, true);

        // Write audio data
        let offset = 44;
        for (let i = 0; i < data.length; i++) {
          const sample = Math.max(-1, Math.min(1, data[i]));
          view.setInt16(offset, sample * 0x7fff, true);
          offset += 2;
        }

        return arrayBuffer;
      }

      function writeString(view, offset, string) {
        for (let i = 0; i < string.length; i++) {
          view.setUint8(offset + i, string.charCodeAt(i));
        }
      }
    </script>
  </body>
</html>
